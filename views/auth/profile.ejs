<%- include('../partials/header', { page: 'profile', categories: categories }) %>

<div class="profile-page">
  <div class="profile-container">
    <div class="profile-header">
      <div class="profile-avatar">
        <%= user.name ? user.name.charAt(0).toUpperCase() : 'U' %>
      </div>
      <div class="profile-info">
        <h1><%= user.name || 'User' %></h1>
        <p class="profile-email"><%= user.email %></p>
        <p class="profile-joined">Member since <%= new Date(user.created_at).toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) %></p>
      </div>
    </div>

    <% if (req && req.query && req.query.success) { %>
    <div class="auth-success">Profile updated successfully</div>
    <% } %>
    <% if (req && req.query && req.query.error) { %>
    <div class="auth-error">Failed to update profile. Please try again.</div>
    <% } %>

    <div class="profile-section">
      <h2>Edit Profile</h2>
      <form action="/auth/profile" method="POST" class="profile-form">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" value="<%= user.name || '' %>" placeholder="Your name">
        </div>
        <button type="submit" class="btn-auth-submit">Update Profile</button>
      </form>
    </div>

    <div class="profile-section">
      <h2>Saved Articles</h2>
      <% if (savedArticles && savedArticles.length > 0) { %>
      <div class="saved-articles-list">
        <% savedArticles.forEach(article => { %>
        <article class="saved-article-item">
          <div class="saved-article-cat"><%= article.category_name || 'News' %></div>
          <h4><a href="/article/<%= article.id %>"><%= article.title %></a></h4>
          <div class="saved-article-meta">
            <span><%= article.reading_time || '5' %> min read</span>
            <span>Saved <%= new Date(article.saved_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) %></span>
          </div>
        </article>
        <% }) %>
      </div>
      <% } else { %>
      <div class="empty-state">
        <p>No saved articles yet.</p>
        <p>Browse articles and click the save button to bookmark them here.</p>
        <a href="/all" class="btn-primary">Browse Articles</a>
      </div>
      <% } %>
    </div>

    <div class="profile-section profile-actions">
      <a href="/auth/logout" class="btn-logout">Sign Out</a>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
